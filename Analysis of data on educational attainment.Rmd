---
title: "An analysis of data on educational attainment and deprivation in Scotland*"
author: "Adam C. Buckley"
date: "02/05/2022"
output:
  bookdown::html_document2:
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo = FALSE}
dat <- read.csv("scottishData.csv")

glasgow <- subset(dat, Council_area == "Glasgow City") 
edinburgh <- subset(dat, Council_area == "City of Edinburgh") 

```

## Summary

In this report, we investigate data on demographics in Scotland, particularly relating to educational attainment and focusing especially on the financial and mental well being of the sample population. Covering areas such as employment, substance abuse, crime rates, overcrowding rates and average drive times.

## Introduction

The data used in this report are from the  2020 Scottish Index of Multiple Deprivation, a tool used by government
bodies to support policy-making.  The aim is to understand the relationship between variables in the data set by comparing different parts of their correlation

The data include various variables for different "data zones" in Scotland. Data zones are small geographical areas typically containing a population of between 500 and 1000 people. There are 6,976 data zones in total in Scotland, but the analysis in this report focuses on a sample of 400 of them, of which 100 are from the Glasgow City, 100 are from City of Edinburgh, and 200 are from elsewhere in Scotland. The data set contains many different variables, of which we will focus in particular on attainment and the effect of attainment on other data such as alcohol usage, attendance, employment and broadband.

## Methods

We use various methods of exploratory data analysis, including plotting and graphing to visualise our data, and performing hypothesis tests to compare the variances of different data and see if they are similar. We use exploratory plots to visualize our data in a variety of ways.

## Results

### Comparing educational attainment between the cities of Glasgow and Edinburgh

In this section, we focus on the available data for Glasgow and Edinburgh, for each of which the data set contains 100 observations (data zones). For these data zones, the following boxplots summarise the distribution of the educational attainment variable:


```{r}

boxplot(glasgow$Attainment, edinburgh$Attainment, main = "Boxplots for Attainment", ylab="Attainment",xlab="Council Area",names = c("Glasgow", "Edinburgh"))

```


These boxplots show the attainment of school leavers.

As further numerical summaries of overall attainment and variability in attainment, we compute the sample means and variances respectively. The sample mean attainments for Glasgow and Edinburgh are $\bar{x}_G = 5.36659$ and
$\bar{x}_E = 5.394112$, and the sample variances are
$s^2_G = 2037995$ and
$s^2_E = 0.3771553$.

To investigate the distributions in more detail, the following shows histograms of the attainment values for Glasgow and Edinburgh along side normal QQ plots for attainment.


```{r}

hist(glasgow$Attainment,main="Histogram of Glasgow Attainment",xlab = "Attainment")
hist(edinburgh$Attainment,main="Histogram of Edinburgh Attainment",xlab = "Attainment")
qqnorm(glasgow$Attainment,main="Normal QQ Plot of Glasgow Attainment",ylab = "Attainment")
qqnorm(edinburgh$Attainment,main="Normal QQ Plot of Edinburgh Attainment",ylab = "Attainment")

var.test(glasgow$Attainment, edinburgh$Attainment)

```

To investigate whether or not the variance of attainment is the same in Glasgow and Edinburgh, we consider the null and alternative hypotheses $H_0: \sigma^2_G = \sigma^2_E$ vs $H_1: \sigma^2_G \neq \sigma^2_E$ and can use a test based on the statistic variance. If $H_0$ is true, and supposing the data are normally distributed, then attainment has a normal distribution. The value of this test statistic that we compute from the data is 0.54036. The upper and lower quantiles of the null distribution  are 0.8031007 and 0.3635765. Since the statistic value is too low, there is enough evidence to reject $H_0$. Therefore we can conclude the attainment variance of Glasgow and Edinburgh is not equal.

### Investigating the relationship between educational attainment and other variables
In this section we consider together all of the observations in the data set, not distinguishing whether the observations were from Glasgow, Edinburgh or elsewhere in Scotland.

The following plot shows the relationship between the various variables described in the Introduction section above.

```{r}

pairs(dat[c(18,17,11,8,31)], pch = 1, main = "Matrix of Pairwise Scatterplots")

```

The corresponding numerical values for the Pearson sample correlation coefficients between these variables are 

```{r}

reg1 <- lm(dat$Attainment ~ dat$Attendance)

summary(reg1)

```

We plot again as follows the attainment rate versus the attendance, with an added line of best fit for a regression model.

```{r}

plot(dat$Attendance, dat$Attainment, 
     main = "Scatterplot of Attainment on Attendance",
     xlab = "Attendance",
     ylab = "Attainment",
     pch = 19)
abline(reg1)

```

The line of best fit is of the form attainment = $\beta_0$ + $\beta_1 \times$  attendance where the least-squares estimates of $\beta_0$ and $\beta_1$ are 2.223 and  4.079, respectively. The value of the statistic $t = { \hat{\beta}_1}/\left( \hat{\sigma} / \sqrt{ (n-1)s_x^2 }\right)$, which is useful for testing $H_0: \beta_1 = 0$ vs $H_1: \beta_1 \neq 0$ and has a t distribution under $H_0$, equals 19.08 This corresponds to a $p$-value of <2e-16 confirming that at a significance level of 5%, we reject the null hypothesis $H_0$. Therefor there is enough evidence for us to conclude that there is a linear correlation between attendance and attainment.



### Invevestigation the relationship between crime rates and other health related data
In this section we consider together all of the observations in the data set, not distinguishing whether the observations were from Glasgow, Edinburgh or elsewhere in Scotland.

The following plot shows the relationship between a few various health variables and the crime rates.

```{r}

pairs(dat[c(33,11,12,13,14)], pch = 1, main = "Matrix of Pairwise Scatterplots")

```

These scatterplots show a linear correlation between multiple variables. We plot again as follows the crime rate versus the depression, with an added line of best fit for a regression model.

```{r}

reg2 <- lm(dat$DEPRESS ~ dat$crime_rate)

plot(dat$crime_rate, dat$DEPRESS, 
     main = "Scatterplot of Depression on Crime Rate",
     xlab = "Crime Rate",
     ylab = "Depression",
     pch = 19)
abline(reg2)

```

The corresponding numerical values for the Pearson sample correlation coefficients between these variables are 

```{r}

summary(reg2)

```
The line of best fit is of the form attainment = $\beta_0$ + $\beta_1 \times$  attendance where the least-squares estimates of $\beta_0$ and $\beta_1$ are 1.761e-01 and  5.996e-05, respectively. The value of the statistic $t = { \hat{\beta}_1}/\left( \hat{\sigma} / \sqrt{ (n-1)s_x^2 }\right)$, which is useful for testing $H_0: \beta_1 = 0$ vs $H_1: \beta_1 \neq 0$ and has a t distribution under $H_0$, equals 8.185. This corresponds to a $p$-value of 3.95e-15. Therefore, at a 5% significance level, there is enough evidence to reject $H_0$ and conclude there is a linear relationship between crime rate and depression.

## Conclusions

We have investigated various characteristics of data available for geographical areas in Scotland called "data zones", focusing in particular on Edinburgh and Glasgow.

We have found that there is a significant relationship between attainment and attendance by comparing distributions, looking at relationship between variance and using a t test to determine whether there is a correlation between the two variables.

We have also looked at the possible relations between crime rate and health variables, particularly focusing on depression. Then applying a t test to determine whether there is a correlation between the two variables.

There are some limitations of the current study. One is the lack of exploring into different council areas, especially when analysing the crime rates, looking at the difference of crime between certain areas could reveal a differing relationship between crime rate and other variables. Also, the types of crimes committed are not being distinguished, certain crimes could be more likely among people who take drugs and alcohol.
A future study could investigate the significance of the relationship between crime rates and depression in select council areas.

## Appendix

The R code to produce the analysis and plots in this report is as follows:

```{r ref.label=knitr::all_labels(), echo = T, eval = F}

dat <- read.csv("scottishData.csv")

glasgow <- subset(dat, Council_area == "Glasgow City") 
edinburgh <- subset(dat, Council_area == "City of Edinburgh")


boxplot(glasgow$Attainment, edinburgh$Attainment,main = "Boxplots for Attainment",ylab="Attainment",xlab="Council Area",names = c("Glasgow", "Edinburgh"))


hist(glasgow$Attainment,main="Histogram of Glasgow Attainment",xlab = "Attainment")
hist(edinburgh$Attainment,main="Histogram of Edinburgh Attainment",xlab = "Attainment")
qqnorm(glasgow$Attainment,main="Normal QQ Plot of Glasgow Attainment",ylab = "Attainment")
qqnorm(edinburgh$Attainment,main="Normal QQ Plot of Edinburgh Attainment",ylab = "Attainment")

var.test(glasgow$Attainment, edinburgh$Attainment)


pairs(dat[c(18,17,11,8,31)], pch = 1, main = "Matrix of Pairwise Scatterplots")


reg1 <- lm(dat$Attainment ~ dat$Attendance)

summary(reg1)


plot(dat$Attendance, dat$Attainment, 
     main = "Scatterplot of Attainment on Attendance",
     xlab = "Attendance",
     ylab = "Attainment",
     pch = 19)
abline(reg1)


pairs(dat[c(33,11,12,13,14)], pch = 1, main = "Matrix of Pairwise Scatterplots")


reg2 <- lm(dat$DEPRESS ~ dat$crime_rate)

plot(dat$crime_rate, dat$DEPRESS, 
     main = "Scatterplot of Depression on Crime Rate",
     xlab = "Crime Rate",
     ylab = "Depression",
     pch = 19)
abline(reg2)


summary(reg2)

```

